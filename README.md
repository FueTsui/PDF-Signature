# PDF签名工具

一个简单的PDF签名工具，支持添加图片签名和防伪水印。

## 功能特点

- 支持选择PDF文件和签名图片
- 可调整签名大小和位置
- 支持多页PDF文档
- 内置防伪水印功能
- 支持验证签名真实性

## 安装依赖

```bash
pip install -r requirements.txt
```

### Windows用户额外步骤

Windows用户需要安装poppler才能使用pdf2image功能：

1. 下载poppler: http://blog.alivate.com.au/poppler-windows/
2. 解压到任意目录
3. 将解压目录下的bin文件夹添加到系统PATH环境变量

## 使用方法

1. 运行程序：
```bash
python pdf-signature.py
```

2. 在界面中：
   - 选择要签名的PDF文件
   - 选择签名图片
   - 调整签名大小
   - 拖动调整签名位置
   - 保存签名后的PDF

3. 验证签名：
   - 使用"验证签名"按钮可以检查PDF文件的签名真实性

## 主要功能

- 加载PDF文档并预览
- 添加图片签名到指定页面
- 调整签名大小和位置
- Adobe风格的PDF浏览体验（包括拖动、缩放和惯性滚动）
- 将签名后的PDF保存为新文件

## 最新优化

- 解决了打包成exe后打开PDF、切换页面和保存PDF时出现的闪烁弹窗问题
- 添加页面缓存机制，提高页面切换速度
- 优化PDF渲染方式，提高稳定性
- 添加文件清理功能，自动删除临时文件
- 改进异常处理，提高程序健壮性

## 使用要求

要运行源代码，您需要安装以下依赖：

- Python 3.6+
- PyPDF2
- Pillow (PIL)
- reportlab
- pdf2image
- poppler (pdf2image的外部依赖)

## 如何打包为可执行文件

### Windows

1. 确保`signature.png`文件位于项目根目录
2. 双击运行`生成exe.bat`文件
3. 等待打包完成
4. 打包好的可执行文件位于`dist`目录中

### Linux/macOS

1. 确保`signature.png`文件位于项目根目录
2. 打开终端，进入项目目录
3. 运行以下命令给脚本添加执行权限：
   ```
   chmod +x build_exe.sh
   ```
4. 执行打包脚本：
   ```
   ./build_exe.sh
   ```
5. 打包好的可执行文件位于`dist`目录中

### 关于Poppler

pdf2image库需要Poppler外部依赖才能正常工作：

- Windows用户：建议从[poppler-windows](https://github.com/oschwartz10612/poppler-windows/releases)下载预编译版本，将其bin目录添加到PATH环境变量中
- macOS用户：`brew install poppler`
- Linux用户：`sudo apt-get install poppler-utils`（Ubuntu/Debian）或相应的包管理器命令

打包脚本会自动检测系统中是否已安装Poppler，并在可能的情况下尝试将其包含在可执行文件中。

## 使用说明

1. 运行程序
2. 点击"选择文件"按钮选择PDF文件
3. 点击"选择图片"按钮选择签名图片
4. 使用滑块调整签名大小
5. 浏览PDF文档，找到需要签名的页面
6. 点击"添加签名到当前页"按钮
7. 签名默认添加在页面右下角，可通过拖动调整位置
8. 对需要的每个页面重复步骤5-7
9. 点击"保存PDF"按钮，选择保存位置
10. 程序会生成一个包含签名的新PDF文件，文件名默认为"原文件名_已签名.pdf"

## 快捷操作

- **拖动PDF**：按住鼠标左键拖动（鼠标指针会变为手形）
- **缩放PDF**：按住Ctrl键滚动鼠标滚轮，或使用界面底部的缩放控件
- **拖动签名**：直接点击签名图片拖动到合适位置
- **页面导航**：使用"上一页"/"下一页"按钮，或直接从下拉列表选择页码

## 问题排查

如果在使用过程中遇到问题：

1. **PDF预览无法显示**：请确保已安装Poppler并正确配置
2. **闪烁弹窗**：最新版本已解决此问题，如仍出现，请检查是否使用了最新版本的可执行文件
3. **程序崩溃**：请检查PDF文件是否损坏或格式不正确

## 许可协议

此工具为自由软件，您可以自由使用、修改和分发。 